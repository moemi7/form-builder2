// Import necessary modules
import React, { FunctionComponent } from "react";
import FormBuilder from "../../components/FormBuilder/FormBuilder";
import { getSingleTemplate, getAllTemplateIds } from "../../redux/entities/formBuilderEntity";

// Define the page component
const FormBuilderPage: FunctionComponent = ({ template }) => {
  // Define a default template if template is not available
  const defaultForm = {
    id: "0",
    formName: "",
    formID: "0",
    createdAt: 0,
    creator: "",
    formLayoutComponents: [],
    lastPublishedAt: 0,
    publishHistory: [],
    publishStatus: "draft",
    updatedAt: 0,
  };

  return (
    <>
      <FormBuilder template={template ? template : defaultForm} />
    </>
  );
};

// Export the page component
export default FormBuilderPage;

// Fetch possible paths at build time
export async function getStaticPaths() {
  // Fetch all template ids from your API
  const templateIds = await getAllTemplateIds(); // Implement this function to fetch template ids
  // Generate paths based on template ids
  const paths = templateIds.map((id) => ({
    params: { formId: id.toString() },
  }));

  return {
    paths,
    fallback: false, // or true if you want to handle fallback behavior
  };
}

// Fetch data for each static path
export async function getStaticProps({ params }) {
  // Fetch template data based on formId
  const template = await getSingleTemplate(params.formId as string);

  return {
    props: {
      template,
    },
  };
}
